const express = require('express');
const pgFunctions = require('../../../pgFunctions');
const pool = require('../../../database/db');
const router = express();
const Excel = require('exceljs');
let workbook = new Excel.Workbook();

router.post('/download', async (req, res) => {
    // console.log(req);
    // res.set('Content-disposition: attachment; filename=filename')
    // res.download('a.txt')
// /:year/:month/:day', async (req, res) => {

    // console.log(req.files);
    // const data = await pool.query(pgFunctions.report.createreport, ['2021-01-21'])
    const {data} = req.body
    try {

    workbook.xlsx.readFile('qashach.xlsx')
    .then(function() {

        let worksheet = workbook.worksheets[0];
        let rowIndex = 5;
        let date = new Date()
        worksheet.getRow(1).getCell(2).value = date.getDate() + '.' + date.getMonth() + 1 + '.' + date.getFullYear()
        data.forEach( record => {
            let columnIndex = 1;
            var row = worksheet.getRow(rowIndex);
            Object.keys(record ).forEach(columnName =>{
                row.getCell(columnIndex).value = record[columnName];
                columnIndex++;
                row.commit();
            });
            rowIndex++;
        })

        workbook.xlsx.writeFile(__dirname + '/' +'new.xlsx')

    }).then(()=> {
        res.download(__dirname + '/' +'new.xlsx', (err) => {
            if(err) {
                console.log(err);
            }
        });
    })
    .catch((e)=>{console.log(e)})
    // console.log(__dirname);
    
    }
    catch(err)  {
        console.log(err);
    }
    
    
})

module.exports = router
// router.listen(5000);

var data1 = [
    {
    PoolId: 34,
    PoolName: 'Argisht',
    FishType: null,
    InitialAvgWeight: '0',
    InitialQuantity: '0',
    InitialWeight: '0',
    InQuantity: '15',
    InWeight: '70.0000',
    SaleQuantity: '0',
    SaleWeight: '0',
    MoveQuantity: '0',
    MoveWeight: '0',
    DeadQuantity: '0',
    DeadWeight: '0.00000000000000000000',
    FinalAvgWeight: '15',
    FinalQuantity: '15',
    FinalWeight: '0.22500000000000000000',
    PlusOrMinusQuantity: '0',
    PlusOrMinusWeight: '-69.77500000000000000000',
    Food: '0',
    WeightGrow: '-69.77500000000000000000',
    Coefficient: '0.00000000000000000000'
    },
    {
    PoolId: 37,
    PoolName: 'Lina',
    FishType: null,
    InitialAvgWeight: '0',
    InitialQuantity: '0',
    InitialWeight: '0',
    InQuantity: '500',
    InWeight: '1000.0000',
    SaleQuantity: '0',
    SaleWeight: '0',
    MoveQuantity: '0',
    MoveWeight: '0',
    DeadQuantity: '0',
    DeadWeight: '0.00000000000000000000',
    FinalAvgWeight: '500',
    FinalQuantity: '500',
    FinalWeight: '250.0000000000000000',
    PlusOrMinusQuantity: '0',
    PlusOrMinusWeight: '-750.00000000000000000000',
    Food: '0',
    WeightGrow: '-750.00000000000000000000',
    Coefficient: '0.00000000000000000000'
    },
    {
    PoolId: 23,
    PoolName: '78',
    FishType: 6,
    InitialAvgWeight: '0',
    InitialQuantity: '0',
    InitialWeight: '0',
    InQuantity: '0',
    InWeight: '0',
    SaleQuantity: '0',
    SaleWeight: '0',
    MoveQuantity: '0',
    MoveWeight: '0',
    DeadQuantity: '0',
    DeadWeight: '0.00000000000000000000',
    FinalAvgWeight: '0',
    FinalQuantity: '0',
    FinalWeight: '0.00000000000000000000',
    PlusOrMinusQuantity: '0',
    PlusOrMinusWeight: '0.00000000000000000000',
    Food: '0',
    WeightGrow: '0.00000000000000000000',
    Coefficient: '0'
    },
    {
    PoolId: 32,
    PoolName: 'aa',
    FishType: 6,
    InitialAvgWeight: '0',
    InitialQuantity: '0',
    InitialWeight: '0',
    InQuantity: '0',
    InWeight: '0',
    SaleQuantity: '0',
    SaleWeight: '0',
    MoveQuantity: '0',
    MoveWeight: '0',
    DeadQuantity: '0',
    DeadWeight: '0.00000000000000000000',
    FinalAvgWeight: '0',
    FinalQuantity: '0',
    FinalWeight: '0.00000000000000000000',
    PlusOrMinusQuantity: '0',
    PlusOrMinusWeight: '0.00000000000000000000',
    Food: '0',
    WeightGrow: '0.00000000000000000000',
    Coefficient: '0'
    },
    {
    PoolId: 25,
    PoolName: '1_1',
    FishType: 2,
    InitialAvgWeight: '0',
    InitialQuantity: '0',
    InitialWeight: '0',
    InQuantity: '0',
    InWeight: '0',
    SaleQuantity: '0',
    SaleWeight: '0',
    MoveQuantity: '0',
    MoveWeight: '0',
    DeadQuantity: '0',
    DeadWeight: '0.00000000000000000000',
    FinalAvgWeight: '0',
    FinalQuantity: '0',
    FinalWeight: '0.00000000000000000000',
    PlusOrMinusQuantity: '0',
    PlusOrMinusWeight: '0.00000000000000000000',
    Food: '0',
    WeightGrow: '0.00000000000000000000',
    Coefficient: '0'
    },
    {
    PoolId: 22,
    PoolName: 'anun777aaaappp',
    FishType: 2,
    InitialAvgWeight: '0',
    InitialQuantity: '0',
    InitialWeight: '0',
    InQuantity: '0',
    InWeight: '0',
    SaleQuantity: '0',
    SaleWeight: '0',
    MoveQuantity: '0',
    MoveWeight: '0',
    DeadQuantity: '0',
    DeadWeight: '0.00000000000000000000',
    FinalAvgWeight: '0',
    FinalQuantity: '0',
    FinalWeight: '0.00000000000000000000',
    PlusOrMinusQuantity: '0',
    PlusOrMinusWeight: '0.00000000000000000000',
    Food: '0',
    WeightGrow: '0.00000000000000000000',
    Coefficient: '0'
    },
    {
    PoolId: 27,
    PoolName: 'eepp',
    FishType: 2,
    InitialAvgWeight: '0',
    InitialQuantity: '0',
    InitialWeight: '0',
    InQuantity: '0',
    InWeight: '0',
    SaleQuantity: '0',
    SaleWeight: '0',
    MoveQuantity: '0',
    MoveWeight: '0',
    DeadQuantity: '0',
    DeadWeight: '0.00000000000000000000',
    FinalAvgWeight: '0',
    FinalQuantity: '0',
    FinalWeight: '0.00000000000000000000',
    PlusOrMinusQuantity: '0',
    PlusOrMinusWeight: '0.00000000000000000000',
    Food: '0',
    WeightGrow: '0.00000000000000000000',
    Coefficient: '0'
    },
    {
    PoolId: 18,
    PoolName: 'poxeci',
    FishType: 7,
    InitialAvgWeight: '0',
    InitialQuantity: '0',
    InitialWeight: '0',
    InQuantity: '0',
    InWeight: '0',
    SaleQuantity: '0',
    SaleWeight: '0',
    MoveQuantity: '0',
    MoveWeight: '0',
    DeadQuantity: '0',
    DeadWeight: '0.00000000000000000000',
    FinalAvgWeight: '0',
    FinalQuantity: '0',
    FinalWeight: '0.00000000000000000000',
    PlusOrMinusQuantity: '0',
    PlusOrMinusWeight: '0.00000000000000000000',
    Food: '0',
    WeightGrow: '0.00000000000000000000',
    Coefficient: '0'
    },
    {
    PoolId: 33,
    PoolName: 'aaa',
    FishType: null,
    InitialAvgWeight: '0',
    InitialQuantity: '0',
    InitialWeight: '0',
    InQuantity: '0',
    InWeight: '0',
    SaleQuantity: '0',
    SaleWeight: '0',
    MoveQuantity: '0',
    MoveWeight: '0',
    DeadQuantity: '0',
    DeadWeight: '0.00000000000000000000',
    FinalAvgWeight: '0',
    FinalQuantity: '0',
    FinalWeight: '0.00000000000000000000',
    PlusOrMinusQuantity: '0',
    PlusOrMinusWeight: '0.00000000000000000000',
    Food: '0',
    WeightGrow: '0.00000000000000000000',
    Coefficient: '0'
    },
    {
    PoolId: 24,
    PoolName: '3->5',
    FishType: 7,
    InitialAvgWeight: '0',
    InitialQuantity: '0',
    InitialWeight: '0',
    InQuantity: '0',
    InWeight: '0',
    SaleQuantity: '0',
    SaleWeight: '0',
    MoveQuantity: '0',
    MoveWeight: '0',
    DeadQuantity: '0',
    DeadWeight: '0.00000000000000000000',
    FinalAvgWeight: '0',
    FinalQuantity: '0',
    FinalWeight: '0.00000000000000000000',
    PlusOrMinusQuantity: '0',
    PlusOrMinusWeight: '0.00000000000000000000',
    Food: '0',
    WeightGrow: '0.00000000000000000000',
    Coefficient: '0'
    },
    {
    PoolId: 26,
    PoolName: 'Ավազան1',
    FishType: 6,
    InitialAvgWeight: '1.0000',
    InitialQuantity: '1',
    InitialWeight: '1.0000',
    InQuantity: '1',
    InWeight: '1.0000',
    SaleQuantity: '0',
    SaleWeight: '0',
    MoveQuantity: '0',
    MoveWeight: '0',
    DeadQuantity: '0',
    DeadWeight: '0.00000000000000000000',
    FinalAvgWeight: '2.0000',
    FinalQuantity: '2',
    FinalWeight: '0.00400000000000000000',
    PlusOrMinusQuantity: '0',
    PlusOrMinusWeight: '-1.99600000000000000000',
    Food: '0',
    WeightGrow: '-1.99600000000000000000',
    Coefficient: '0.00000000000000000000'
    },
    {
    PoolId: 26,
    PoolName: 'Ավազան1',
    FishType: 6,
    InitialAvgWeight: '1.0000',
    InitialQuantity: '1',
    InitialWeight: '1.0000',
    InQuantity: '1',
    InWeight: '1.0000',
    SaleQuantity: '0',
    SaleWeight: '0',
    MoveQuantity: '0',
    MoveWeight: '0',
    DeadQuantity: '0',
    DeadWeight: '0.00000000000000000000',
    FinalAvgWeight: '2.0000',
    FinalQuantity: '2',
    FinalWeight: '0.00400000000000000000',
    PlusOrMinusQuantity: '0',
    PlusOrMinusWeight: '-1.99600000000000000000',
    Food: '0',
    WeightGrow: '-1.99600000000000000000',
    Coefficient: '0.00000000000000000000'
    },
    {
    PoolId: 36,
    PoolName: 'yyyyyyy',
    FishType: null,
    InitialAvgWeight: '0',
    InitialQuantity: '0',
    InitialWeight: '0',
    InQuantity: '0',
    InWeight: '0',
    SaleQuantity: '0',
    SaleWeight: '0',
    MoveQuantity: '0',
    MoveWeight: '0',
    DeadQuantity: '0',
    DeadWeight: '0.00000000000000000000',
    FinalAvgWeight: '0',
    FinalQuantity: '0',
    FinalWeight: '0.00000000000000000000',
    PlusOrMinusQuantity: '0',
    PlusOrMinusWeight: '0.00000000000000000000',
    Food: '0',
    WeightGrow: '0.00000000000000000000',
    Coefficient: '0'
    },
    {
    PoolId: 35,
    PoolName: 'Argisht1',
    FishType: null,
    InitialAvgWeight: '0',
    InitialQuantity: '0',
    InitialWeight: '0',
    InQuantity: '0',
    InWeight: '0',
    SaleQuantity: '0',
    SaleWeight: '0',
    MoveQuantity: '0',
    MoveWeight: '0',
    DeadQuantity: '0',
    DeadWeight: '0.00000000000000000000',
    FinalAvgWeight: '0',
    FinalQuantity: '0',
    FinalWeight: '0.00000000000000000000',
    PlusOrMinusQuantity: '0',
    PlusOrMinusWeight: '0.00000000000000000000',
    Food: '0',
    WeightGrow: '0.00000000000000000000',
    Coefficient: '0'
    },
    {
    PoolId: 28,
    PoolName: 'ավազան1',
    FishType: 6,
    InitialAvgWeight: '0',
    InitialQuantity: '0',
    InitialWeight: '0',
    InQuantity: '250',
    InWeight: '450.0000',
    SaleQuantity: '0',
    SaleWeight: '0',
    MoveQuantity: '15',
    MoveWeight: '70.0000',
    DeadQuantity: '0',
    DeadWeight: '0.00000000000000000000',
    FinalAvgWeight: '235',
    FinalQuantity: '235',
    FinalWeight: '55.2250000000000000',
    PlusOrMinusQuantity: '0',
    PlusOrMinusWeight: '-324.77500000000000000000',
    Food: '0',
    WeightGrow: '-324.77500000000000000000',
    Coefficient: '0.00000000000000000000'
    },
    {
    PoolId: 30,
    PoolName: 'ավազան2',
    FishType: 7,
    InitialAvgWeight: '0',
    InitialQuantity: '0',
    InitialWeight: '0',
    InQuantity: '1000',
    InWeight: '500.0000',
    SaleQuantity: '0',
    SaleWeight: '0',
    MoveQuantity: '0',
    MoveWeight: '0',
    DeadQuantity: '0',
    DeadWeight: '0.00000000000000000000',
    FinalAvgWeight: '1000',
    FinalQuantity: '1000',
    FinalWeight: '1000.0000000000000000',
    PlusOrMinusQuantity: '0',
    PlusOrMinusWeight: '500.00000000000000000000',
    Food: '0',
    WeightGrow: '500.00000000000000000000',
    Coefficient: '0.00000000000000000000'
    },
    {
    PoolId: 31,
    PoolName: 'ավազան3',
    FishType: 6,
    InitialAvgWeight: '0',
    InitialQuantity: '0',
    InitialWeight: '0',
    InQuantity: '0',
    InWeight: '0',
    SaleQuantity: '0',
    SaleWeight: '0',
    MoveQuantity: '0',
    MoveWeight: '0',
    DeadQuantity: '0',
    DeadWeight: '0.00000000000000000000',
    FinalAvgWeight: '0',
    FinalQuantity: '0',
    FinalWeight: '0.00000000000000000000',
    PlusOrMinusQuantity: '0',
    PlusOrMinusWeight: '0.00000000000000000000',
    Food: '0',
    WeightGrow: '0.00000000000000000000',
    Coefficient: '0'
    },
    {
    PoolId: 38,
    PoolName: 'ada',
    FishType: null,
    InitialAvgWeight: '0',
    InitialQuantity: '0',
    InitialWeight: '0',
    InQuantity: '0',
    InWeight: '0',
    SaleQuantity: '0',
    SaleWeight: '0',
    MoveQuantity: '0',
    MoveWeight: '0',
    DeadQuantity: '0',
    DeadWeight: '0.00000000000000000000',
    FinalAvgWeight: '0',
    FinalQuantity: '0',
    FinalWeight: '0.00000000000000000000',
    PlusOrMinusQuantity: '0',
    PlusOrMinusWeight: '0.00000000000000000000',
    Food: '0',
    WeightGrow: '0.00000000000000000000',
    Coefficient: '0'
    },
    {
    PoolId: 39,
    PoolName: 'Ավազան 5',
    FishType: null,
    InitialAvgWeight: '0',
    InitialQuantity: '0',
    InitialWeight: '0',
    InQuantity: '0',
    InWeight: '0',
    SaleQuantity: '0',
    SaleWeight: '0',
    MoveQuantity: '0',
    MoveWeight: '0',
    DeadQuantity: '0',
    DeadWeight: '0.00000000000000000000',
    FinalAvgWeight: '0',
    FinalQuantity: '0',
    FinalWeight: '0.00000000000000000000',
    PlusOrMinusQuantity: '0',
    PlusOrMinusWeight: '0.00000000000000000000',
    Food: '0',
    WeightGrow: '0.00000000000000000000',
    Coefficient: '0'
    }
    ]